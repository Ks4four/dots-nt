name: Draw Keymap (Corne Eyelash)

on:
  workflow_dispatch:
  push:
    paths:
      - "zmk/corne-eyelash/config/*.keymap"
      - "zmk/corne-eyelash/keymap_drawer.config.yaml"
      - ".github/workflows/zmk-draw-corne-eyelash.yaml"

permissions:
  contents: write

jobs:
  draw:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - name: Install keymap-drawer
        run: pip install keymap-drawer

      - name: Draw Keymap
        run: |
          # 1. 确保输出目录存在
          mkdir -p zmk/corne-eyelash/keymap-drawer

          # 2. 解析 Keymap 生成 YAML
          # -c: 配置文件路径
          # -z: ZMK keymap 路径
          # 输出重定向到 yaml 文件
          keymap parse \
            -c zmk/corne-eyelash/keymap_drawer.config.yaml \
            -z zmk/corne-eyelash/config/eyelash_corne.keymap \
            > zmk/corne-eyelash/keymap-drawer/eyelash_corne.yaml

          # 3. 根据 YAML 生成 SVG 图片
          keymap draw \
            -c zmk/corne-eyelash/keymap_drawer.config.yaml \
            zmk/corne-eyelash/keymap-drawer/eyelash_corne.yaml \
            > zmk/corne-eyelash/keymap-drawer/eyelash_corne.svg

      - name: Commit updated images
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "[Draw] Update Corne Eyelash keymap SVG"
          # 只提交生成的文件
          file_pattern: "zmk/corne-eyelash/keymap-drawer/*.svg zmk/corne-eyelash/keymap-drawer/*.yaml"